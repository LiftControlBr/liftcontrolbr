<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist Digital ‚Äì Lift Control</title>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: linear-gradient(135deg, #2c5364 0%, #203a43 50%, #0f2027 100%);
      min-height: 100vh;
      color: #223151;
    }
    
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 10px 25px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 25px;
      transition: all 0.3s ease;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      display: block;
      width: fit-content;
    }
    
    .back-link:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    form {
      max-width: 800px;
      background: white;
      margin: auto;
      padding: 30px 40px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,.3);
    }
    
    h1 {
      color: #2c5364;
      text-align: center;
      margin-bottom: 30px;
    }
    
    h2 {
      color: #2c5364;
      margin-top: 30px;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 2px solid #2c5364;
      padding-bottom: 8px;
    }
    
    label {
      display: block;
      margin-top: 20px;
      font-weight: 600;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px 14px;
      font-size: 15px;
      border-radius: 6px;
      border: 1.5px solid #ccc;
      margin-top: 8px;
      box-sizing: border-box;
      font-weight: 500;
      color: #223151;
      resize: vertical;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #2c5364;
    }
    
    /* Campos pr√©-preenchidos ficam com fundo cinza claro */
    input.auto-filled, select.auto-filled {
      background-color: #f0f8ff;
      border-color: #2c5364;
    }
    
    textarea {
      min-height: 100px;
    }
    
    label.check-item {
      display: flex;
      align-items: center;
      margin-top: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #223151;
      user-select: none;
      cursor: pointer;
    }
    
    label.check-item input[type="checkbox"] {
      margin-right: 10px;
      width: 22px;
      height: 22px;
      cursor: pointer;
    }
    
    button {
      margin-top: 30px;
      background-color: #2c5364;
      color: white;
      border: none;
      padding: 15px 45px;
      border-radius: 50px;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(44, 83, 100, 0.3);
    }
    
    button:hover:not(:disabled) {
      background-color: #1a3a47;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(44, 83, 100, 0.4);
    }
    
    button:disabled {
      background-color: #999;
      cursor: not-allowed;
    }
    
    .checklist-section {
      margin-top: 20px;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }
    
    .required {
      color: #e74c3c;
      font-weight: bold;
    }
    
    .signature-section {
      margin-top: 30px;
      padding: 25px;
      background: #f0f8ff;
      border: 2px dashed #2c5364;
      border-radius: 10px;
    }
    
    .signature-section h3 {
      color: #2c5364;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .signature-info {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-size: 14px;
      color: #555;
      border-left: 4px solid #2c5364;
    }
    
    .signature-preview {
      margin-top: 15px;
      padding: 20px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      text-align: center;
      font-style: italic;
      color: #2c5364;
      font-size: 24px;
      font-family: 'Brush Script MT', cursive;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .auto-fill-badge {
      display: inline-block;
      background: #2c5364;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    
    .loading-overlay.active {
      display: flex;
    }
    
    .loading-content {
      background: white;
      padding: 40px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2c5364;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <h3 style="color: #2c5364; margin-bottom: 10px;">Gerando e enviando PDF...</h3>
      <p style="color: #666;">Aguarde um momento</p>
    </div>
  </div>

  <a href="index.html" class="back-link">‚Üê Voltar ao Menu</a>
  
  <form id="checklistForm" novalidate>
    <h1>Checklist Digital ‚Äì Lift Control</h1>

    <label for="nomeCondominio">
      Nome do Condom√≠nio <span class="required">*</span>
      <span class="auto-fill-badge">‚úì Auto-preenchido</span>
    </label>
    <input id="nomeCondominio" name="nomeCondominio" type="text" required autocomplete="off" class="auto-filled" readonly />

    <label for="endereco">
      Endere√ßo Completo <span class="required">*</span>
      <span class="auto-fill-badge">‚úì Auto-preenchido</span>
    </label>
    <input id="endereco" name="endereco" type="text" required autocomplete="off" class="auto-filled" readonly />

    <label for="totalElevadores">
      Total de Elevadores no Pr√©dio <span class="required">*</span>
      <span class="auto-fill-badge">‚úì Auto-preenchido</span>
    </label>
    <input id="totalElevadores" name="totalElevadores" type="number" min="1" required autocomplete="off" class="auto-filled" readonly />

    <label for="elevadorInspecionado">Elevador Inspecionado <span class="required">*</span></label>
    <select id="elevadorInspecionado" name="elevadorInspecionado" required>
      <option value="" disabled selected>Selecione...</option>
      <option>Social</option>
      <option>Servi√ßo</option>
      <option>Elevador 1</option>
      <option>Elevador 2</option>
      <option>Elevador 3</option>
    </select>

    <label for="emailCondominio">
      Email do Condom√≠nio <span class="required">*</span>
      <span class="auto-fill-badge">‚úì Auto-preenchido</span>
    </label>
    <input id="emailCondominio" name="emailCondominio" type="email" required autocomplete="off" class="auto-filled" readonly />

    <label for="telefoneResponsavel">
      Telefone do Respons√°vel <span class="required">*</span>
      <span class="auto-fill-badge">‚úì Auto-preenchido</span>
    </label>
    <input id="telefoneResponsavel" name="telefoneResponsavel" type="text" pattern="^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$" required autocomplete="off" placeholder="(11) 98765-4321" class="auto-filled" readonly />

    <label for="dataManutencao">Data da Manuten√ß√£o <span class="required">*</span></label>
    <input id="dataManutencao" name="dataManutencao" type="date" required />

    <label for="tipoManutencao">Tipo de Manuten√ß√£o <span class="required">*</span></label>
    <select id="tipoManutencao" name="tipoManutencao" required>
      <option value="" disabled selected>Selecione...</option>
      <option>Preventiva</option>
      <option>Corretiva</option>
      <option>Emergencial</option>
    </select>

    <label for="nomeTecnico">Nome Completo do T√©cnico <span class="required">*</span></label>
    <input id="nomeTecnico" name="nomeTecnico" type="text" required autocomplete="off" />

    <label for="empresaTecnico">Empresa do T√©cnico <span class="required">*</span></label>
    <input id="empresaTecnico" name="empresaTecnico" type="text" required autocomplete="off" />

    <label for="registroTecnico">CREA / Registro Profissional</label>
    <input id="registroTecnico" name="registroTecnico" type="text" autocomplete="off" />

    <div class="checklist-section">
      <h2>Casa de M√°quinas</h2>
      <label class="check-item"><input type="checkbox" name="motor" /> Motor de tra√ß√£o</label>
      <label class="check-item"><input type="checkbox" name="freio" /> Freio eletromagn√©tico</label>
      <label class="check-item"><input type="checkbox" name="redutor" /> Redutor</label>
      <label class="check-item"><input type="checkbox" name="quadro" /> Quadro de comando</label>
      <label class="check-item"><input type="checkbox" name="limitador" /> Limitador de velocidade</label>
      <label class="check-item"><input type="checkbox" name="cabos" /> Cabos de tra√ß√£o</label>
      <label class="check-item"><input type="checkbox" name="polias" /> Polias</label>
      <label class="check-item"><input type="checkbox" name="ventilacao" /> Ventila√ß√£o da casa</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoEmergencia" /> Ilumina√ß√£o de emerg√™ncia</label>
      <label class="check-item"><input type="checkbox" name="limpeza" /> Limpeza geral</label>
    </div>

    <div class="checklist-section">
      <h2>Cabina</h2>
      <label class="check-item"><input type="checkbox" name="portas" /> Portas</label>
      <label class="check-item"><input type="checkbox" name="botoes" /> Bot√µes</label>
      <label class="check-item"><input type="checkbox" name="display" /> Display / Indicadores</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoInterna" /> Ilumina√ß√£o interna</label>
      <label class="check-item"><input type="checkbox" name="ventilacaoCabina" /> Ventila√ß√£o / Exaustor</label>
      <label class="check-item"><input type="checkbox" name="interfone" /> Interfone / Alarme</label>
      <label class="check-item"><input type="checkbox" name="espelho" /> Espelho / Acabamentos</label>
      <label class="check-item"><input type="checkbox" name="piso" /> Piso / Nivelamento</label>
    </div>

    <div class="checklist-section">
      <h2>Po√ßo</h2>
      <label class="check-item"><input type="checkbox" name="amortecedores" /> Amortecedores</label>
      <label class="check-item"><input type="checkbox" name="limpezaPoco" /> Limpeza do po√ßo</label>
      <label class="check-item"><input type="checkbox" name="drenagem" /> Drenagem de √°gua</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoPoco" /> Ilumina√ß√£o</label>
      <label class="check-item"><input type="checkbox" name="cabosEletricos" /> Cabos el√©tricos</label>
    </div>

    <label for="reparosExecutados" style="margin-top: 30px;">Reparos Executados <span class="required">*</span></label>
    <textarea id="reparosExecutados" name="reparosExecutados" minlength="10" required placeholder="Descreva os reparos executados durante a manuten√ß√£o..."></textarea>

    <label for="observacoes" style="margin-top: 20px;">Observa√ß√µes / Recomenda√ß√µes</label>
    <textarea id="observacoes" name="observacoes" placeholder="Observa√ß√µes adicionais ou recomenda√ß√µes para pr√≥ximas manuten√ß√µes..."></textarea>

    <!-- SE√á√ÉO DE ASSINATURA DIGITAL -->
    <div class="signature-section">
      <h3>üìù Assinatura Digital</h3>
      <label for="assinaturaTecnico">Digite seu nome completo para assinar <span class="required">*</span></label>
      <input id="assinaturaTecnico" name="assinaturaTecnico" type="text" required autocomplete="off" placeholder="Nome completo do t√©cnico respons√°vel" />
      
      <div class="signature-preview" id="signaturePreview">
        Sua assinatura aparecer√° aqui
      </div>
      
      <div class="signature-info">
        ‚ÑπÔ∏è <strong>Como funciona:</strong> Digite seu nome completo acima. O PDF ser√° gerado automaticamente e <strong>enviado para o email do condom√≠nio</strong> com sua assinatura digital.
      </div>
    </div>

    <button type="submit" id="submitButton">Gerar e Enviar PDF</button>
  </form>

  <script>
    // ========== PROTE√á√ÉO DE ACESSO ==========
    window.addEventListener('load', function() {
      const auth = localStorage.getItem('liftcontrol_auth');
      if (!auth) {
        alert('Acesso n√£o autorizado. Fa√ßa login primeiro.');
        window.location.href = 'index.html';
        return;
      }
      
      // AUTO-PREENCHE OS DADOS DO CONDOM√çNIO
      const dados = JSON.parse(localStorage.getItem('liftcontrol_dados'));
      if (dados) {
        document.getElementById('nomeCondominio').value = dados.nome;
        document.getElementById('endereco').value = dados.endereco;
        document.getElementById('emailCondominio').value = dados.email;
        document.getElementById('telefoneResponsavel').value = dados.telefone;
        document.getElementById('totalElevadores').value = dados.totalElevadores;
      }
    });

    // ========== PREVIEW DA ASSINATURA ==========
    document.getElementById('assinaturaTecnico').addEventListener('input', function(e) {
      const preview = document.getElementById('signaturePreview');
      if (e.target.value.trim()) {
        preview.textContent = e.target.value;
        preview.style.color = '#2c5364';
      } else {
        preview.textContent = 'Sua assinatura aparecer√° aqui';
        preview.style.color = '#999';
      }
    });

    // ========== INICIALIZA EMAILJS ==========
    // VOC√ä PRECISA CRIAR UMA CONTA EM: https://www.emailjs.com/
    // E SUBSTITUIR ESTES VALORES:
    emailjs.init("SUA_PUBLIC_KEY_AQUI"); // Substitua pela sua Public Key

    // ========== GERA√á√ÉO E ENVIO DO PDF ==========
    document.getElementById('checklistForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!e.target.checkValidity()) {
        alert('Por favor, preencha todos os campos obrigat√≥rios corretamente.');
        e.target.reportValidity();
        return;
      }

      // Mostra loading
      document.getElementById('loadingOverlay').classList.add('active');
      document.getElementById('submitButton').disabled = true;

      const dados = {};
      new FormData(e.target).forEach((value, key) => {
        dados[key] = value;
      });

      const checkboxIds = [
        'motor','freio','redutor','quadro','limitador','cabos','polias','ventilacao','iluminacaoEmergencia','limpeza',
        'portas','botoes','display','iluminacaoInterna','ventilacaoCabina','interfone','espelho','piso',
        'amortecedores','limpezaPoco','drenagem','iluminacaoPoco','cabosEletricos'
      ];
      
      checkboxIds.forEach(id => {
        const el = e.target.elements[id];
        dados[id] = el && el.checked ? "‚úì Ok" : "‚úó Pendente";
      });

      function formatDateBR(dateStr) {
        if(!dateStr) return '-';
        const [year, month, day] = dateStr.split("-");
        return `${day}/${month}/${year}`;
      }
      dados.dataManutencao = formatDateBR(dados.dataManutencao);

      // ========== GERA O PDF ==========
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF('p', 'pt', 'a4');
      
      const margin = 40;
      const pageWidth = pdf.internal.pageSize.width;
      const pageHeight = pdf.internal.pageSize.height;
      const contentWidth = pageWidth - (margin * 2);
      const maxY = pageHeight - margin - 50;
      
      let y = margin;
      let currentPage = 1;

      function addNewPage() {
        pdf.addPage();
        currentPage++;
        y = margin;
      }

      function checkPageBreak(requiredSpace) {
        if (y + requiredSpace > maxY) {
          addNewPage();
        }
      }

      function printMainTitle(text) {
        checkPageBreak(50);
        pdf.setFont('helvetica', 'bold');
        pdf.setFontSize(18);
        pdf.setTextColor(44, 83, 100);
        pdf.text(text, pageWidth / 2, y, { align: 'center' });
        y += 25;
      }

      function printSectionTitle(text) {
        checkPageBreak(30);
        pdf.setFont('helvetica', 'bold');
        pdf.setFontSize(13);
        pdf.setTextColor(44, 83, 100);
        
        pdf.text(text, margin, y);
        y += 3;
        pdf.setDrawColor(44, 83, 100);
        pdf.setLineWidth(1.5);
        pdf.line(margin, y, pageWidth - margin, y);
        y += 12;
        pdf.setTextColor(0, 0, 0);
      }

      function printField(label, value) {
        checkPageBreak(20);
        
        pdf.setFont('helvetica', 'bold');
        pdf.setFontSize(9);
        pdf.text(label + ':', margin, y);
        
        pdf.setFont('helvetica', 'normal');
        pdf.setFontSize(9);
        
        const labelWidth = pdf.getTextWidth(label + ': ') + 5;
        const remainingWidth = contentWidth - labelWidth;
        const lines = pdf.splitTextToSize(value, remainingWidth);
        
        pdf.text(lines[0], margin + labelWidth, y);
        
        for (let i = 1; i < lines.length; i++) {
          y += 12;
          checkPageBreak(15);
          pdf.text(lines[i], margin + labelWidth, y);
        }
        
        y += 14;
      }

      function printCheckItem(label, status) {
        checkPageBreak(18);
        
        pdf.setFont('helvetica', 'bold');
        pdf.setFontSize(9);
        
        if (status.includes('Ok')) {
          pdf.setTextColor(0, 120, 0);
          pdf.text('‚úì Ok', margin + 10, y);
        } else {
          pdf.setTextColor(200, 0, 0);
          pdf.text('‚úó Pendente', margin + 10, y);
        }
        
        pdf.setTextColor(0, 0, 0);
        pdf.setFont('helvetica', 'normal');
        pdf.text(label, margin + 90, y);
        
        y += 14;
      }

      function printLongText(text) {
        checkPageBreak(25);
        
        pdf.setFont('helvetica', 'normal');
        pdf.setFontSize(9);
        
        const lines = pdf.splitTextToSize(text, contentWidth - 20);
        
        lines.forEach(line => {
          checkPageBreak(15);
          pdf.text(line, margin + 10, y);
          y += 13;
        });
        
        y += 5;
      }

      function printSignature() {
        checkPageBreak(80);
        
        y += 20;
        pdf.setFont('helvetica', 'bold');
        pdf.setFontSize(12);
        pdf.setTextColor(44, 83, 100);
        pdf.text('Assinatura Digital', margin, y);
        y += 20;
        
        pdf.setDrawColor(44, 83, 100);
        pdf.setLineWidth(1);
        pdf.rect(margin, y, contentWidth, 40);
        
        pdf.setFont('helvetica', 'italic');
        pdf.setFontSize(16);
        pdf.setTextColor(44, 83, 100);
        pdf.text(dados.assinaturaTecnico, pageWidth / 2, y + 25, { align: 'center' });
        
        y += 50;
        
        const agora = new Date();
        const dataHora = `${agora.toLocaleDateString('pt-BR')} √†s ${agora.toLocaleTimeString('pt-BR')}`;
        
        pdf.setFont('helvetica', 'normal');
        pdf.setFontSize(8);
        pdf.setTextColor(100, 100, 100);
        pdf.text(`Documento assinado digitalmente em: ${dataHora}`, margin, y);
        y += 12;
        pdf.text(`T√©cnico: ${dados.assinaturaTecnico} - ${dados.empresaTecnico}`, margin, y);
      }

      // ========== MONTA O PDF ==========
      printMainTitle('CHECKLIST DIGITAL - LIFT CONTROL');
      
      printSectionTitle('Dados do Condom√≠nio');
      printField('Nome', dados.nomeCondominio);
      printField('Endere√ßo', dados.endereco);
      printField('Total de Elevadores', dados.totalElevadores);
      printField('Elevador Inspecionado', dados.elevadorInspecionado);
      printField('Email', dados.emailCondominio);
      printField('Telefone', dados.telefoneResponsavel);
      
      y += 5;
      
      printSectionTitle('Dados da Manuten√ß√£o');
      printField('Data', dados.dataManutencao);
      printField('Tipo', dados.tipoManutencao);
      printField('T√©cnico Respons√°vel', dados.nomeTecnico);
      printField('Empresa', dados.empresaTecnico);
      printField('Registro Profissional', dados.registroTecnico || 'N√£o informado');
      
      y += 5;
      
      printSectionTitle('Casa de M√°quinas');
      printCheckItem('Motor de tra√ß√£o', dados.motor);
      printCheckItem('Freio eletromagn√©tico', dados.freio);
      printCheckItem('Redutor', dados.redutor);
      printCheckItem('Quadro de comando', dados.quadro);
      printCheckItem('Limitador de velocidade', dados.limitador);
      printCheckItem('Cabos de tra√ß√£o', dados.cabos);
      printCheckItem('Polias', dados.polias);
      printCheckItem('Ventila√ß√£o da casa', dados.ventilacao);
      printCheckItem('Ilumina√ß√£o de emerg√™ncia', dados.iluminacaoEmergencia);
      printCheckItem('Limpeza geral', dados.limpeza);
      
      y += 5;
      
      printSectionTitle('Cabina');
      printCheckItem('Portas', dados.portas);
      printCheckItem('Bot√µes', dados.botoes);
      printCheckItem('Display / Indicadores', dados.display);
      printCheckItem('Ilumina√ß√£o interna', dados.iluminacaoInterna);
      printCheckItem('Ventila√ß√£o / Exaustor', dados.ventilacaoCabina);
      printCheckItem('Interfone / Alarme', dados.interfone);
      printCheckItem('Espelho / Acabamentos', dados.espelho);
      printCheckItem('Piso / Nivelamento', dados.piso);
      
      y += 5;
      
      printSectionTitle('Po√ßo');
      printCheckItem('Amortecedores', dados.amortecedores);
      printCheckItem('Limpeza do po√ßo', dados.limpezaPoco);
      printCheckItem('Drenagem de √°gua', dados.drenagem);
      printCheckItem('Ilumina√ß√£o', dados.iluminacaoPoco);
      printCheckItem('Cabos el√©tricos', dados.cabosEletricos);
      
      y += 5;
      
      printSectionTitle('Reparos Executados');
      printLongText(dados.reparosExecutados || 'Nenhum reparo executado.');
      
      printSectionTitle('Observa√ß√µes / Recomenda√ß√µes');
      printLongText(dados.observacoes || 'Sem observa√ß√µes adicionais.');
      
      printSignature();
      
      checkPageBreak(30);
      y += 10;
      pdf.setFontSize(8);
      pdf.setFont('helvetica', 'italic');
      pdf.setTextColor(100, 100, 100);
      pdf.text(
        `Documento gerado automaticamente por Lift Control`,
        pageWidth / 2,
        y,
        { align: 'center' }
      );

      const totalPages = pdf.internal.pages.length - 1;
      for (let i = 1; i <= totalPages; i++) {
        pdf.setPage(i);
        pdf.setFontSize(9);
        pdf.setFont('helvetica', 'normal');
        pdf.setTextColor(100, 100, 100);
        pdf.text(
          `P√°gina ${i} de ${totalPages}`,
          pageWidth / 2,
          pageHeight - 20,
          { align: 'center' }
        );
      }

      // Converte PDF para base64
      const pdfBase64 = pdf.output('datauristring').split(',')[1];
      
      const nomeArquivo = `Checklist_${dados.nomeCondominio.replace(/[^a-zA-Z0-9]/g, '')}_${dados.elevadorInspecionado.replace(/\s+/g, '')}_${new Date().toISOString().split('T')[0]}.pdf`;

      // ========== ENVIA EMAIL ==========
      try {
        await emailjs.send(
          "SEU_SERVICE_ID",  // Substitua pelo seu Service ID
          "SEU_TEMPLATE_ID", // Substitua pelo seu Template ID
          {
            to_email: dados.emailCondominio,
            to_name: dados.nomeCondominio,
            from_name: "Lift Control",
            condominio: dados.nomeCondominio,
            elevador: dados.elevadorInspecionado,
            tecnico: dados.nomeTecnico,
            data: dados.dataManutencao,
            pdf_attachment: pdfBase64,
            pdf_filename: nomeArquivo
          }
        );

        // Sucesso
        document.getElementById('loadingOverlay').classList.remove('active');
        alert('‚úÖ PDF gerado e enviado com sucesso para ' + dados.emailCondominio + '!\n\nO PDF tamb√©m ser√° baixado no seu dispositivo.');
        
        // Faz download tamb√©m
        pdf.save(nomeArquivo);
        
        // Limpa formul√°rio (exceto dados pr√©-preenchidos)
        document.getElementById('elevadorInspecionado').value = '';
        document.getElementById('dataManutencao').value = '';
        document.getElementById('tipoManutencao').value = '';
        document.getElementById('nomeTecnico').value = '';
        document.getElementById('empresaTecnico').value = '';
        document.getElementById('registroTecnico').value = '';
        document.getElementById('reparosExecutados').value = '';
        document.getElementById('observacoes').value = '';
        document.getElementById('assinaturaTecnico').value = '';
        document.getElementById('signaturePreview').textContent = 'Sua assinatura aparecer√° aqui';
        
        // Desmarca checkboxes
        checkboxIds.forEach(id => {
          const el = document.querySelector(`input[name="${id}"]`);
          if (el) el.checked = false;
        });
        
      } catch (error) {
        console.error('Erro ao enviar email:', error);
        document.getElementById('loadingOverlay').classList.remove('active');
        
        // Ainda assim faz o download
        pdf.save(nomeArquivo);
        alert('‚ö†Ô∏è PDF gerado e baixado com sucesso!\n\nPor√©m houve um erro ao enviar o email automaticamente.\nPor favor, envie o PDF manualmente para: ' + dados.emailCondominio);
      }
      
      document.getElementById('submitButton').disabled = false;
    });
  </script>
</body>
</html>
