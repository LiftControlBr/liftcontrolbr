<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checklist Digital – Lift Control - PDF com múltiplas páginas</title>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f7f9fc;
      color: #1f2d48;
      margin: 0; padding: 30px;
    }
    form {
      max-width: 820px;
      margin: 0 auto;
      background: #fff;
      border-radius: 14px;
      padding: 40px 35px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      color: #223151;
    }
    h1, h2, h3 {
      color: #223151;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: 700;
    }
    label {
      font-weight: 600;
      margin-top: 20px;
      display: block;
    }
    input, select, textarea {
      box-sizing: border-box;
      width: 100%;
      padding: 12px 16px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1.5px solid #ccd7e0;
      font-size: 14pt;
      color: #223151;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    label.check-item {
      display: flex;
      align-items: center;
      background: #e8eef6;
      padding: 12px 16px;
      border-radius: 10px;
      margin-top: 10px;
      cursor: pointer;
      font-size: 13pt;
      color: #1f2d48;
      user-select: none;
    }
    label.check-item input {
      margin-right: 15px;
      width: 26px;
      height: 26px;
      cursor: pointer;
    }
    .buttons {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
    }
    button {
      background: #223151;
      color: white;
      padding: 15px 50px;
      border: none;
      border-radius: 50px;
      font-size: 16pt;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-shadow: 0 5px 15px rgba(34, 49, 81, 0.7);
    }
    button:hover {
      background-color: #1a2436;
    }
    @media(max-width: 600px) {
      form {
        padding: 20px 20px;
      }
      button {
        width: 100%;
        font-size: 18pt;
      }
    }
  </style>
</head>
<body>
  <form id="checklistForm" novalidate>
    <h1>Checklist Digital – Lift Control</h1>

    <label for="nomeCondominio">Nome do Condomínio <span style="color:#dd4b39">*</span></label>
    <input id="nomeCondominio" name="nomeCondominio" type="text" placeholder="Ex: Edifício Solar" required autocomplete="off" />

    <label for="endereco">Endereço Completo <span style="color:#dd4b39">*</span></label>
    <input id="endereco" name="endereco" type="text" required autocomplete="off" />

    <label for="totalElevadores">Total de Elevadores no Prédio <span style="color:#dd4b39">*</span></label>
    <input id="totalElevadores" type="number" name="totalElevadores" min="1" required autocomplete="off" />

    <label for="elevadorInspecionado">Elevador Inspecionado <span style="color:#dd4b39">*</span></label>
    <select id="elevadorInspecionado" name="elevadorInspecionado" required>
      <option value="" selected disabled>Selecione...</option>
      <option>Social</option>
      <option>Serviço</option>
      <option>Elevador 1</option>
      <option>Elevador 2</option>
      <option>Elevador 3</option>
    </select>

    <label for="emailCondominio">Email do Condomínio <span style="color:#dd4b39">*</span></label>
    <input id="emailCondominio" name="emailCondominio" type="email" placeholder="contato@condominio.com" required autocomplete="off" />

    <label for="telefoneResponsavel">Telefone do Responsável <span style="color:#dd4b39">*</span></label>
    <input id="telefoneResponsavel" name="telefoneResponsavel" type="text" placeholder="(13) 99999-9999" pattern="^\(?\d{2}\)?\s?\d{4,5}-?\d{4}$" required autocomplete="off" title="Formato esperado: (13) 99999-9999" />

    <label for="dataManutencao">Data da Manutenção <span style="color:#dd4b39">*</span></label>
    <input id="dataManutencao" name="dataManutencao" type="date" required />

    <label for="tipoManutencao">Tipo de Manutenção <span style="color:#dd4b39">*</span></label>
    <select id="tipoManutencao" name="tipoManutencao" required>
      <option value="" selected disabled>Selecione...</option>
      <option>Preventiva</option>
      <option>Corretiva</option>
      <option>Emergencial</option>
    </select>

    <label for="nomeTecnico">Nome Completo do Técnico <span style="color:#dd4b39">*</span></label>
    <input id="nomeTecnico" name="nomeTecnico" type="text" required placeholder="Nome completo" autocomplete="off" />

    <label for="empresaTecnico">Empresa do Técnico <span style="color:#dd4b39">*</span></label>
    <input id="empresaTecnico" name="empresaTecnico" type="text" required autocomplete="off" />

    <label for="registroTecnico">CREA / Registro Profissional</label>
    <input id="registroTecnico" name="registroTecnico" type="text" autocomplete="off" />

    <div class="checklist-section">
      <h2>Casa de Máquinas</h2>
      <label class="check-item"><input type="checkbox" name="motor" /> Motor de tração - Estado geral</label>
      <label class="check-item"><input type="checkbox" name="freio" /> Freio eletromagnético - Funcionamento</label>
      <label class="check-item"><input type="checkbox" name="redutor" /> Redutor - Nível de óleo / ruídos</label>
      <label class="check-item"><input type="checkbox" name="quadro" /> Quadro de comando - Limpeza / conexões</label>
      <label class="check-item"><input type="checkbox" name="limitador" /> Limitador de velocidade - Teste</label>
      <label class="check-item"><input type="checkbox" name="cabos" /> Cabos de tração - Desgaste / lubrificação</label>
      <label class="check-item"><input type="checkbox" name="polias" /> Polias - Estado / alinhamento</label>
      <label class="check-item"><input type="checkbox" name="ventilacao" /> Ventilação da casa de máquinas</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoEmergencia" /> Iluminação de emergência</label>
      <label class="check-item"><input type="checkbox" name="limpeza" /> Limpeza geral do ambiente</label>
    </div>

    <div class="checklist-section">
      <h2>Cabina</h2>
      <label class="check-item"><input type="checkbox" name="portas" /> Portas - Abertura / fechamento</label>
      <label class="check-item"><input type="checkbox" name="botoes" /> Botões - Funcionamento</label>
      <label class="check-item"><input type="checkbox" name="display" /> Display / Indicadores</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoInterna" /> Iluminação interna</label>
      <label class="check-item"><input type="checkbox" name="ventilacaoCabina" /> Ventilação / Exaustor</label>
      <label class="check-item"><input type="checkbox" name="interfone" /> Interfone / Alarme</label>
      <label class="check-item"><input type="checkbox" name="espelho" /> Espelho / Acabamentos</label>
      <label class="check-item"><input type="checkbox" name="piso" /> Piso / Nivelamento</label>
    </div>

    <div class="checklist-section">
      <h2>Poço</h2>
      <label class="check-item"><input type="checkbox" name="amortecedores" /> Amortecedores - Estado</label>
      <label class="check-item"><input type="checkbox" name="limpezaPoco" /> Limpeza do poço</label>
      <label class="check-item"><input type="checkbox" name="drenagem" /> Drenagem de água</label>
      <label class="check-item"><input type="checkbox" name="iluminacaoPoco" /> Iluminação</label>
      <label class="check-item"><input type="checkbox" name="cabosEletricos" /> Cabos elétricos - Fixação</label>
    </div>

    <label for="reparosExecutados" style="margin-top: 30px;">Reparos Executados <span class="required">*</span></label>
    <textarea id="reparosExecutados" name="reparosExecutados" minlength="10" required placeholder="Descreva detalhadamente os reparos..."></textarea>

    <label for="observacoes" style="margin-top: 20px;">Observações / Recomendações</label>
    <textarea id="observacoes" name="observacoes" placeholder="Observações importantes ou recomendações"></textarea>

    <div class="buttons">
      <button type="submit">Gerar PDF</button>
    </div>
  </form>

<script>
document.getElementById('checklistForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  if (!e.target.checkValidity()) {
    alert('Por favor, preencha todos os campos obrigatórios corretamente.');
    e.target.reportValidity();
    return;
  }

  try {
    const dados = {};
    new FormData(e.target).forEach((value, key) => {
      dados[key] = value;
    });

    const checkboxIds = ['motor','freio','redutor','quadro','limitador','cabos','polias','ventilacao','iluminacaoEmergencia','limpeza',
                        'portas','botoes','display','iluminacaoInterna','ventilacaoCabina','interfone','espelho','piso',
                        'amortecedores','limpezaPoco','drenagem','iluminacaoPoco','cabosEletricos'];

    checkboxIds.forEach(id => {
      const el = e.target.elements[id];
      dados[id] = el && el.checked ? "Ok" : "Pendente";
    });

    function formatDateBR(dateString) {
      if(!dateString) return '-';
      const [year, month, day] = dateString.split("-");
      return `${day}/${month}/${year}`;
    }
    dados.dataManutencao = formatDateBR(dados.dataManutencao);

    const content = `
      <div style="font-family: Arial, sans-serif; padding: 20px; color: #223151; font-size: 16pt; line-height: 1.5;">
        <h2 style="text-align:center; font-weight: 700; font-size: 20pt; color: #223151;">
          Checklist Digital – Lift Control
        </h2>
        <hr style="border-color: #bbbcbe; margin: 10px 0 20px 0;" />
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-bottom: 10px;">Dados do Condomínio</h3>
        <p><strong>Nome:</strong> ${dados.nomeCondominio}</p>
        <p><strong>Endereço:</strong> ${dados.endereco}</p>
        <p><strong>Total de Elevadores:</strong> ${dados.totalElevadores}</p>
        <p><strong>Elevador Inspecionado:</strong> ${dados.elevadorInspecionado}</p>
        <p><strong>Email:</strong> ${dados.emailCondominio}</p>
        <p><strong>Telefone:</strong> ${dados.telefoneResponsavel}</p>
        <hr style="border-color: #bbbcbe; margin: 20px 0;" />
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-bottom: 10px;">Manutenção</h3>
        <p><strong>Data:</strong> ${dados.dataManutencao}</p>
        <p><strong>Tipo:</strong> ${dados.tipoManutencao}</p>
        <p><strong>Técnico:</strong> ${dados.nomeTecnico}</p>
        <p><strong>Empresa:</strong> ${dados.empresaTecnico}</p>
        <p><strong>Registro:</strong> ${dados.registroTecnico || 'N/A'}</p>
        <hr style="border-color: #bbbcbe; margin: 20px 0;" />
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-bottom: 10px;">Casa de Máquinas</h3>
        <ul style="font-size: 14pt; margin-left: 15px;">
          <li>Motor de tração: ${dados.motor}</li>
          <li>Freio eletromagnético: ${dados.freio}</li>
          <li>Redutor: ${dados.redutor}</li>
          <li>Quadro de comando: ${dados.quadro}</li>
          <li>Limitador de velocidade: ${dados.limitador}</li>
          <li>Cabos de tração: ${dados.cabos}</li>
          <li>Polias: ${dados.polias}</li>
          <li>Ventilação: ${dados.ventilacao}</li>
          <li>Iluminação de emergência: ${dados.iluminacaoEmergencia}</li>
          <li>Limpeza geral: ${dados.limpeza}</li>
        </ul>
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-top: 20px; margin-bottom: 10px;">Cabina</h3>
        <ul style="font-size: 14pt; margin-left: 15px;">
          <li>Portas: ${dados.portas}</li>
          <li>Botões: ${dados.botoes}</li>
          <li>Display / Indicadores: ${dados.display}</li>
          <li>Iluminação interna: ${dados.iluminacaoInterna}</li>
          <li>Ventilação / Exaustor: ${dados.ventilacaoCabina}</li>
          <li>Interfone / Alarme: ${dados.interfone}</li>
          <li>Espelho / Acabamentos: ${dados.espelho}</li>
          <li>Piso / Nivelamento: ${dados.piso}</li>
        </ul>
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-top: 20px; margin-bottom: 10px;">Poço</h3>
        <ul style="font-size: 14pt; margin-left: 15px;">
          <li>Amortecedores: ${dados.amortecedores}</li>
          <li>Limpeza do poço: ${dados.limpezaPoco}</li>
          <li>Drenagem de água: ${dados.drenagem}</li>
          <li>Iluminação: ${dados.iluminacaoPoco}</li>
          <li>Cabos elétricos: ${dados.cabosEletricos}</li>
        </ul>
        <hr style="border-color: #bbbcbe; margin: 20px 0;" />
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-bottom: 10px;">Reparos Executados</h3>
        <p style="font-size: 15pt; margin-left: 15px;">${dados.reparosExecutados}</p>
        <h3 style="font-weight: 700; font-size: 18pt; color: #223151; margin-top: 20px; margin-bottom: 10px;">Observações / Recomendações</h3>
        <p style="font-size: 15pt; margin-left: 15px;">${dados.observacoes || ''}</p>
        <hr style="border-color: #bbbcbe; margin-top: 20px;" />
        <p style="font-size: 14pt; color: #777; text-align: center;">Gerado por Lift Control - 2025</p>
      </div>`;

    const container = document.createElement('div');
    container.style.width = '900px';
    container.style.padding = "20px";
    container.style.background = "white";
    container.innerHTML = content;
    document.body.appendChild(container);

    html2canvas(container, {scale: 3, scrollY: -window.scrollY}).then(canvasImg => {
      const imgData = canvasImg.toDataURL('image/png');
      const {jsPDF} = window.jspdf;
      const pdf = new jsPDF('p', 'pt', 'a4');
      const pdfWidth = pdf.internal.pageSize.getWidth() - 40; // margem 20pt cada lado
      const pdfHeight = pdf.internal.pageSize.getHeight() - 40; // margem 20pt cima/baixo

      const imgHeight = (canvasImg.height * pdfWidth) / canvasImg.width;

      let heightLeft = imgHeight;
      let positionY = 20;

      // Função para recortar fatia da imagem do canvas original
      function getImageSlice(sy, sh) {
        const sliceCanvas = document.createElement('canvas');
        sliceCanvas.width = canvasImg.width;
        sliceCanvas.height = sh;
        const sliceCtx = sliceCanvas.getContext('2d');
        sliceCtx.drawImage(canvasImg, 0, sy, canvasImg.width, sh, 0, 0, canvasImg.width, sh);
        return sliceCanvas.toDataURL('image/png');
      }

      let sourceY = 0;
      const pageHeightPx = canvasImg.width * pdfHeight / pdfWidth;

      while (heightLeft > 0) {
        const sliceHeight = Math.min(pageHeightPx, canvasImg.height - sourceY);
        const sliceData = getImageSlice(sourceY, sliceHeight);

        if (sourceY > 0) {
          pdf.addPage();
          positionY = 20;
        }
        const sliceHeightPt = sliceHeight * pdfWidth / canvasImg.width;

        pdf.addImage(sliceData, 'PNG', 20, positionY, pdfWidth, sliceHeightPt);

        heightLeft -= pdfHeight;
        sourceY += sliceHeight;
      }

      pdf.save(`Checklist_${dados.nomeCondominio.replace(/\s+/g, '')}_${dados.elevadorInspecionado.replace(/\s+/g, '')}.pdf`);
      document.body.removeChild(container);
    });
  } catch (e) {
    alert("Erro ao gerar PDF:\n" + e);
  }
});
</script>
</body>
</html>
